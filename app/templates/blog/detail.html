{% extends 'blog/blog.html' %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/blog_detail.css') }}">
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-2 border-right">
    <div id="sidebar">
      <h6 class="ml-3 mb-0">TOC</h6>
      <div class="markdown-body editormd-preview-container" id="custom-toc-container" previewcontainer="false"></div>
    </div>
  </div>
  <div class="col-1">
    <nav class="nav justify-content-center">
    <div class="position-fixed">
      {% if prev_url %}
      <a href="{{ prev_url }}">
        <i width="150" height="150" class="text-warning" data-feather="chevron-left"></i>
      </a>
      {% else %}
      <i width="150" height="150" class="text-muted" data-feather="chevron-left"></i>
      {% endif %}
      </div>
    </nav>
  </div>
  <div class="col-8 shadow-lg p-3 rounded">
    <h2>{{ post.title }}</h2>
    <ul class="list-inline text-muted">
      <li class="list-inline-item mr-3">{{ post.pub_date.date() }}</li>
      <li class="list-inline-item"><i data-feather="eye" style="padding-bottom: 3px"></i> {{ post.pv }}</li>
    </ul>
    <div class="btn-group-sm" role="group">
      {% for tag in post.tags %}
      <a href="{{ url_for('tag.tag_filter', name=tag.name) }}">
        <button type="button" class="btn btn-info" style="padding: 0 5px 0 5px">{{ tag.name }}</button>
      </a>
      {% endfor %}
    </div>
    <hr>
    <div id="md2html" >
      <textarea style="display:none;">{{ post.content }}</textarea>
    </div>

    <!-- zanzhu -->
    <div class="text-center mt-5">
      <button class="btn btn-sm btn-info" type="button" data-toggle="collapse" data-target="#zanzhu">
        小额赞助 <i class="fas fa-feather-alt"></i>
      </button>

      <div id="zanzhu" class="collapse mt-3">
        <span class="text-warning">随意赞助，鼓励老邢写出更好更多的文章</span>
        <ul class="list-inline mt-3">
          <li class="list-inline-item mr-5">
            <figure class="figure">
              <img src="{{ url_for('static', filename='images/zanzhu/weixinpay.png') }}" class="figure-img img-fluid rounded" style="width: 250px">
              <figcaption class="figure-caption text-center" style="color: green">微信</figcaption>
            </figure>
          </li>
          <li class="list-inline-item ml-5">
            <figure class="figure">
              <img src="{{ url_for('static', filename='images/zanzhu/zhifubaopay.png') }}" class="figure-img img-fluid rounded" style="width: 250px">
              <figcaption class="figure-caption text-center" style="color: deepskyblue">支付宝</figcaption>
            </figure>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="col-1">
    <nav class="nav justify-content-center">
      <div class="position-fixed">
        {% if next_url %}
        <a href="{{ next_url }}">
          <i width="150" height="150" class="text-warning" data-feather="chevron-right"></i>
        </a>
        {% else %}
        <i width="150" height="150" class="text-muted" data-feather="chevron-right"></i>
        {% endif %}
      </div>
    </nav>
    <div style="margin-top: 450px">
      <div class="position-fixed">
        <button id="back_top" type="button" class="btn btn-link" style="display: none">
          <img src="{{ url_for('static', filename='images/top-alignment.png') }}">
        </button>
      </div>
    </div>
  </div>
</div>
<hr>


<!-- editor.md -->
<script src="{{ url_for('static',filename='editormd/lib/marked.min.js') }}"></script>
<script src="{{ url_for('static',filename='editormd/lib/prettify.min.js') }}"></script>
<script src="{{ url_for('static',filename='editormd/lib/raphael.min.js') }}"></script>
<script src="{{ url_for('static',filename='editormd/lib/underscore.min.js') }}"></script>
<script src="{{ url_for('static',filename='editormd/lib/sequence-diagram.min.js') }}"></script>
<script src="{{ url_for('static',filename='editormd/lib/flowchart.min.js') }}"></script>
<script src="{{ url_for('static',filename='editormd/lib/jquery.flowchart.min.js') }}"></script>
<script type="text/javascript">
// 根据屏幕高度，设置目录侧边栏高度
$(window).on("load resize",function(){
    var h=$(window).height() - 120;
    $("#sidebar").css("height",h);
});


$(function() {
  var mdEditor;

  mdEditor = editormd.markdownToHTML("md2html", {
      //htmlDecode      : true,       // 开启 HTML 标签解析，为了安全性，默认不开启
      htmlDecode      : "style,script,iframe",  // you can filter tags decode
      //toc             : false,
      tocm            : true,    // Using [TOCM]
      tocContainer    : "#custom-toc-container", // 自定义 ToC 容器层
      //gfm             : false,
      //tocDropdown     : true,
      // markdownSourceCode : true, // 是否保留 Markdown 源码，即是否删除保存源码的 Textarea 标签
      emoji           : true,
      taskList        : true,
      tex             : true,  // 默认不解析
      flowChart       : true,  // 默认不解析
      sequenceDiagram : true,  // 默认不解析
  });

  //console.log("返回一个 jQuery 实例 =>", testEditormdView);

  // 获取Markdown源码
  //console.log(testEditormdView.getMarkdown());

  //alert(testEditormdView.getMarkdown());
});
</script>


<!-- back top -->
<script type="text/javascript">
$(function () {
    // 获取要大于的高度
    var headheight = $('.header').height();
    window.onscroll=function () {
        //获取浏览器滚轴滚动的距离
        var scrollTop = $(window).scrollTop();
        //当浏览器滚轴滚动的距离 大于 设定的高度时 显示“点击返回顶部”按钮，否则隐藏
        if(scrollTop > headheight) {
            $('#back_top').show()
        } else {
            $('#back_top').hide()
        }
    };
    //点击返回顶部500ms的滑动效果
    $('#back_top').on('click',function () {
        $('html,body').animate({scrollTop:0},500);
    })
})
</script>
{% endblock %}